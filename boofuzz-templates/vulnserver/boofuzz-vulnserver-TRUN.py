#!/usr/bin/env python
from boofuzz import *
import sys

def recieve_ftp_banner(sock):
	sock.recv(1024)

def callback(session, node, edge, sock):
	if ((not session.last_recv) and (session.last_send)):
		print session.last_send
		print len(session.last_send)
		sys.exit(-1)

def main():
	host = '192.168.0.96'
	port = 9999

	with open('boofuzz-ftp.log', 'wb') as f:
		logger = FuzzLogger(fuzz_loggers=[FuzzLoggerText(file_handle=f)])

		session = Session(
			crash_threshold=1,
			target=Target(
				connection=SocketConnection(host, int(port), proto='tcp')
			),
			fuzz_data_logger=logger
		)

		s_initialize("TRUN")
		s_string('TRUN', name='TRUN-Command')
		s_delim(' ', name='TRUN-Space')
		s_string('A', name='TRUN-STRING')
		s_static('\r\n', name='TRUN-CRLF')

		session.pre_send = recieve_ftp_banner


		session.connect(s_get("TRUN"), callback=callback)

		session.fuzz()

if __name__ == '__main__':
	main()
