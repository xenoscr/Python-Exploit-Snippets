#!/usr/bin/env python
from boofuzz import *

def recieve_ftp_banner(sock):
	sock.recv(1024)

def main():
	host = '127.0.0.1'
	port = 21
	username = 'anonymous'
	password = 'anony@mous.com'

	with open('boofuzz-ftp.log', 'wb') as f:
		logger = FuzzLogger(fuzz_loggers=[FuzzLoggerText(file_handle=f)])

		session = Session(
			target=Target(
				connection=SocketConnection(host, int(port), proto='tcp')
			),
			fuzz_data_logger=logger
		)

		s_initialize("user")
		s_string('USER', name='User-Command')
		s_delim(' ', name='User-Space')
		s_string(username, name='User-Username')
		s_static('\r\n', name='User-CRLF')

		s_initialize("pass")
		s_string('PASS', name='Pass-Command')
		s_delim(' ', name='Pass-Space')
		s_string(password, name='Pass-Password')
		s_static('\r\n', name='Pass-CRLF')

		s_initialize("cwd")
		s_string('CWD', name='CWD-Command')
		s_delim(' ', name='CWD-Space')
		s_string('C: ', name='CWD-Password')
		s_static('\r\n', name='CWD-CRLF')

		s_initialize("dele")
		s_string('DELE', name='DELE-Command')
		s_delim(' ', name='DELE-Space')
		s_string('C:\\test.txt', name='DELE-Password')
		s_static('\r\n', name='DELE-CRLF')

		s_initialize("mdtm")
		s_string('MDTM', name='MDTM-Command')
		s_delim(' ', name='MDTM-Space')
		s_string('C:\\boot.ini', name='MDTM-Password')
		s_static('\r\n', name='MDTM-CRLF')

		s_initialize("mkd")
		s_string('MKD', name='MKD-Command')
		s_delim(' ', name='MKD-Space')
		s_string('C:\\testdir', name='MKD-Password')
		s_static('\r\n', name='MKD-CRLF')

		session.pre_send = recieve_ftp_banner

		session.connect(s_get("user"))
		session.connect(s_get("user"), s_get("pass"))
		session.connect(s_get("pass"), s_get("cwd"))
		session.connect(s_get("pass"), s_get("dele"))
		session.connect(s_get("pass"), s_get("mdtm"))
		session.connect(s_get("pass"), s_get("mkd"))

		session.fuzz()

if __name__ == '__main__':
	main()
